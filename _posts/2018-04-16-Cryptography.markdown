---
layout:     post
title:      "æµ…æžå¯†ç å­¦åŸºç¡€"
date:       2018-04-16
author:     "K"
header-img: "img/post-bg-markdown.jpg"
tags: 
    - å¯†ç å­¦
---

å¯†ç å­¦æŠ€æœ¯é€šå¸¸å…·æœ‰æœºå¯†æ€§ã€å®Œæ•´æ€§ã€è®¤è¯ã€ä¸å¯å¦è®¤æ€§ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªç‰¹æ€§ï¼ŒçŽ°å®žåº”ç”¨ä¸­å¾€å¾€éœ€è¦ç»„åˆä½¿ç”¨ä»¥å‘æŒ¥å„è‡ªä¼˜åŠ¿ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œæœºå¯†æ€§æ˜¯ä¸ºäº†ç¡®ä¿åŽŸå§‹ä¿¡æ¯ä¸ä¼šè¢«çªƒå¬ï¼Œå› æ­¤è¿›è¡ŒåŠ å¯†æ“ä½œï¼Œå¯¹åº”çš„æŠ€æœ¯æ˜¯å¯¹ç§°åŠ å¯†å’Œéžå¯¹ç§°åŠ å¯†ç®—æ³•ã€‚å®Œæ•´æ€§æ˜¯ç¡®ä¿æ¶ˆæ¯ä¸è¢«ç¯¡æ”¹ï¼Œå› æ­¤éœ€è¦å¯¹ä¿¡æ¯è¿›è¡Œå®Œæ•´æ€§æ ¡éªŒï¼Œå¯¹åº”çš„æŠ€æœ¯æœ‰å•å‘æ•£åˆ—å‡½æ•°ã€æ¶ˆæ¯éªŒè¯ç ã€æ•°å­—ç­¾åã€‚è®¤è¯æ˜¯ä¸ºäº†é˜²æ­¢æ”»å‡»è€…ä¼ªè£…æˆçœŸæ­£çš„å‘é€è€…ï¼Œå› æ­¤éœ€è¦æ£€æŸ¥æ¶ˆæ¯æ˜¯å¦æ¥è‡ªåˆæ³•çš„å‘é€è€…ï¼Œå¯¹åº”çš„å¯†ç æŠ€æœ¯æœ‰æ¶ˆæ¯éªŒè¯ç ï¼Œæ•°å­—ç­¾åã€‚ä¸å¯å¦è®¤æ€§æ˜¯ä¸ºäº†é˜²æ­¢ä¿¡æ¯å‘é€è€…äº‹åŽå¦è®¤å‘å¸ƒçš„è¡Œä¸ºï¼Œå› æ­¤éœ€è¦ç­¾åè¯æ˜Žæ¶ˆæ¯çš„æ¥æºï¼Œå¯¹åº”çš„å¯†ç æŠ€æœ¯ä¸ºæ•°å­—ç­¾åã€‚å¸¸è§[æŠ€æœ¯å›¾è°±](https://xiaoxueying.gitbooks.io/graphic-cryptology/content/cryptogram_world.html)å¦‚ä¸‹æ‰€ç¤ºï¼Œæœ¬æ–‡å°†æ•´ç†ä¸€äº›ç›¸å…³ç¬”è®°ï¼ˆæ›´æ–°ä¸­ï¼‰ã€‚

![](https://xiaoxueying.gitbooks.io/graphic-cryptology/content/cryptogram.png)

## å•å‘å‡½æ•°

å“ˆå¸Œå‡½æ•°åœ¨æ—¥å¸¸ä¸­è¾ƒä¸ºå¸¸è§ï¼Œæ¯”å¦‚åœ¨ä¸‹è½½å¤§æ–‡ä»¶æ—¶ï¼Œä¸ºäº†ä¾›ç”¨æˆ·éªŒè¯å®Œæ•´æ€§å¸¸å¸¸ä¼šæä¾›ä¸€ä¸²å“ˆå¸Œå€¼ï¼Œä¸€èˆ¬ä¸º MD5. MD5 å’Œ SHA ä¹Ÿæ˜¯æœ€å¸¸è§çš„å•å‘æ•£åˆ—å‡½æ•°ï¼ŒSHA å…¶å®žä»£è¡¨çš„æ˜¯ SHA å®¶æ—ç®—æ³•ï¼Œå¹¶ä¸ç‰¹æŒ‡æŸä¸€ä¸ªã€‚æœ‰ SHA-1ã€SHA-2ã€SHA-3 ç³»åˆ—ï¼Œå…¶ä¸­ SHA-1 å·²ç»ä¸å†å®‰å…¨ï¼ŒSHA-2 ä¸­å…·ä½“ç»†åˆ†ä¸º SHA-224ã€SHA-256ã€SHA-384ã€SHA-512 ç­‰ç®—æ³•ï¼Œæœ€å¸¸è§çš„å°±æ˜¯ SHA-256ï¼Œç›®å‰ä»å¹¿æ³›ä½¿ç”¨ã€‚æ›´æ–°ç‰ˆæœ¬çš„ SHA-3 ä¸æ˜¯ SHA-2 çš„ç›´æŽ¥æ”¹è¿›ç‰ˆï¼Œä¸¤è€…æ²¡æœ‰å¤ªå¤§çš„å…³è”ã€‚ä¸‹é¢é’ˆå¯¹å‡ ä¸ªä»£è¡¨è¿›è¡Œä»‹ç»ã€‚

å“ˆå¸Œå‡½æ•°å…·å¤‡ä»¥ä¸‹ç‰¹ç‚¹ï¼šè¾“å…¥ä»»æ„å¤§å°çš„å­—ç¬¦ä¸²ï¼Œäº§ç”Ÿå›ºå®šå¤§å°çš„è¾“å‡ºï¼Œè®¡ç®—ç®€å•ï¼Œä¸”é‡å¤è®¡ç®—å…·æœ‰ç¡®å®šæ€§ï¼Œåªæœ‰ä¿®æ”¹äº†è¾“å…¥ï¼Œå°½ç®¡å˜åŠ¨å¾ˆå°ï¼Œè¾“å‡ºä¹Ÿä¼šå‘ç”Ÿå¾ˆå¤§å˜åŒ–ã€‚

å“ˆå¸Œå‡½æ•°çš„å®‰å…¨ä¸€èˆ¬æ»¡è¶³ä»¥ä¸‹ä¸‰æ¡æ€§è´¨ï¼š

- åŽŸåƒç¨³å›ºæ€§ï¼šç»™å®šä¸€ä¸ªå“ˆå¸Œå€¼ï¼Œåœ¨H(x)çš„æ˜ å°„ä¸‹ï¼Œæ‰¾ä¸åˆ°å¯¹åº”çš„ xï¼Œå…¶å®žå°±æ˜¯å•å‘æ€§çš„ä¿è¯ï¼Œæ— æ³•é€†è¿ç®—
- ç¬¬äºŒåŽŸåƒç¨³å›ºæ€§ï¼šç»™å®šä¸€ä¸ª x å’Œ H(x) çš„æ˜ å°„ï¼Œæ‰¾ä¸åˆ°ä¸€ä¸ª x'ï¼Œä½¿å¾— y ç›¸åŒï¼Œå¼±æŠ—ç¢°æ’žæ€§
- ç¢°æ’žç¨³å›ºæ€§ï¼šç»™å®š Hï¼ˆxï¼‰ï¼Œæ‰¾ä¸åˆ°ä¸åŒçš„ xï¼Œä½¿å¾—å®ƒä»¬å¯¹åº”çš„ y ç›¸åŒï¼ŒæŠ—å¼ºæŠ—ç¢°æ’žæ€§

å¤§å¤šæ•° Hash å‡½æ•°éƒ½æ˜¯é€šè¿‡ Merkle-Damgard (MD)è¿­ä»£ç»“æž„å¯¹åŽ‹ç¼©å‡½æ•°è¿›è¡Œè¿­ä»£å®žçŽ°çš„ã€‚Damgard å’Œ Merkle å®šä¹‰äº†æ‰€è°“ â€œåŽ‹ç¼©å‡½æ•°(compression function)â€ï¼Œå°±æ˜¯å°†ä¸€ä¸ªå›ºå®šé•¿åº¦è¾“å…¥ï¼Œå˜æ¢æˆè¾ƒçŸ­çš„å›ºå®šé•¿åº¦çš„è¾“å‡ºï¼Œè¿™å¯¹å¯†ç å­¦å®žè·µä¸Š Hash å‡½æ•°çš„è®¾è®¡äº§ç”Ÿäº†å¾ˆå¤§çš„å½±å“ã€‚Hash å‡½æ•°å°±æ˜¯è¢«è®¾è®¡ä¸ºåŸºäºŽé€šè¿‡ç‰¹å®šåŽ‹ç¼©å‡½æ•°çš„ä¸æ–­é‡å¤â€œåŽ‹ç¼©â€ è¾“å…¥çš„åˆ†ç»„å’Œå‰ä¸€æ¬¡åŽ‹ç¼©å¤„ç†çš„ç»“æžœçš„è¿‡ç¨‹ï¼Œç›´åˆ°æ•´ä¸ªæ¶ˆæ¯éƒ½è¢«åŽ‹ç¼©å®Œæ¯•ï¼Œæœ€åŽçš„è¾“å‡ºä½œä¸ºæ•´ä¸ªæ¶ˆæ¯çš„æ•£åˆ—å€¼ã€‚å°½ç®¡è¿˜ç¼ºä¹ä¸¥æ ¼çš„è¯æ˜Žï¼Œä½†ç»å¤§å¤šæ•°ä¸šç•Œçš„ç ”ç©¶è€…éƒ½åŒæ„ï¼Œå¦‚æžœåŽ‹ç¼©å‡½æ•°æ˜¯å®‰å…¨çš„ï¼Œé‚£ä¹ˆä»¥ä¸Šè¿°å½¢å¼æ•£åˆ—ä»»æ„é•¿åº¦çš„æ¶ˆæ¯ä¹Ÿå°†æ˜¯å®‰å…¨çš„ã€‚è¿™å°±æ˜¯æ‰€è°“ Damgard/Merkle ç»“æž„ã€‚ä»»æ„é•¿åº¦çš„æ¶ˆæ¯è¢«åˆ†æ‹†æˆç¬¦åˆåŽ‹ç¼©å‡½æ•°è¾“å…¥è¦æ±‚çš„åˆ†ç»„ï¼Œæœ€åŽä¸€ä¸ªåˆ†ç»„å¯èƒ½éœ€è¦åœ¨æœ«å°¾æ·»ä¸Šç‰¹å®šçš„å¡«å……å­—èŠ‚ï¼Œè¿™äº›åˆ†ç»„å°†è¢«é¡ºåºå¤„ç†ï¼Œé™¤äº†ç¬¬ä¸€ä¸ªæ¶ˆæ¯åˆ†ç»„å°†ä¸Žæ•£åˆ—åˆå§‹åŒ–å€¼ä¸€èµ·ä½œä¸ºåŽ‹ç¼©å‡½æ•°çš„è¾“å…¥å¤–ï¼Œå½“å‰åˆ†ç»„å°†å’Œå‰ä¸€ä¸ªåˆ†ç»„çš„åŽ‹ç¼©å‡½æ•°è¾“å‡ºä¸€èµ·è¢«ä½œä¸ºè¿™ä¸€æ¬¡åŽ‹ç¼©çš„è¾“å…¥ï¼Œè€Œå…¶è¾“å‡ºåˆå°†è¢«ä½œä¸ºä¸‹ä¸€ä¸ªåˆ†ç»„åŽ‹ç¼©å‡½æ•°è¾“å…¥çš„ä¸€éƒ¨åˆ†ï¼Œç›´åˆ°æœ€åŽä¸€ä¸ªåŽ‹ç¼©å‡½æ•°çš„è¾“å‡ºï¼Œå°†è¢«ä½œä¸ºæ•´ä¸ªæ¶ˆæ¯æ•£åˆ—çš„ç»“æžœã€‚

ä¸åŒäºŽ SHA-2 ä½¿ç”¨çš„ MD ç»“æž„ï¼Œç¾Žå›½å›½å®¶æ ‡å‡†ä¸ŽæŠ€æœ¯ç ”ç©¶é™¢ï¼ˆNISTï¼‰å‘å¸ƒçš„ç¬¬ä¸‰ä»£å®‰å…¨æ•£åˆ—ç®—æ³• Keccak ä½¿ç”¨çš„æ˜¯ [æµ·ç»µå»ºæž„](https://zh.wikipedia.org/wiki/%E6%B5%B7%E7%B6%BF%E5%87%BD%E6%95%B8)ï¼Œä¹Ÿå«æµ·ç»µå‡½æ•°ã€‚ï¼ˆè¿™ä¸€éƒ¨åˆ†æ·±å…¥è§£é‡Šå¾…è¡¥å……ï¼‰

> [Hash ç®—æ³•åŠå…¶åº”ç”¨](http://www.iwms.net/n923c43.aspx)

## å¯¹ç§°å¯†ç 

### å¯†é’¥é…é€é—®é¢˜

åœ¨å¯¹ç§°å¯†ç ä¸­ï¼Œå¦‚ AESï¼Œç”±äºŽåŠ è§£å¯†ä½¿ç”¨çš„æ˜¯ç›¸åŒçš„å¯†é’¥ï¼Œå› æ­¤ä¸€å®šä¼šé‡åˆ°å¯†é’¥é…é€é—®é¢˜ï¼ˆkey distribution problemï¼‰ã€‚å¸¸è§çš„è§£å†³æ–¹æ¡ˆä¸­æœ‰äº‹å…ˆå…±äº«å¯†é’¥ã€é€šè¿‡å¯†é’¥åˆ†é…ä¸­å¿ƒåˆ†é…ã€Diffie-Hellman å¯†é’¥äº¤æ¢ä»¥åŠé€šè¿‡å…¬é’¥å¯†ç æ¥è§£å†³ï¼Œä¸‹é¢ä»‹ç» Diffie-Hellman å¯†é’¥åå•†ã€‚

#### Diffie-Hellman å¯†é’¥åå•†

å¤§å¤šæ•°å¯†ç æŠ€æœ¯çš„å®‰å…¨ç”±æ•°å­¦éš¾é¢˜ä¿è¯ï¼Œå¦‚ Diffie-Hellman å¯†é’¥åå•†ç®—æ³•çš„å®‰å…¨æ€§ä¾èµ–äºŽæœ‰é™ç¾¤çš„ç¦»æ•£å¯¹æ•°é—®é¢˜ã€‚å¦‚ä¸‹ç­‰å¼ä¸­ï¼Œå·²çŸ¥ gï¼Œxï¼Œp æ±‚ y ååˆ†å®¹æ˜“ï¼Œä½†æ˜¯åå‘è®¡ç®—å´éžå¸¸éš¾ã€‚åœ¨å®žé™…è¿ç®—ä¸­ï¼Œä¸ºäº†ä¿è¯éš¾åº¦ï¼Œé€šå¸¸å¯¹ gï¼Œxï¼Œp æœ‰ä¸€å®šè¦æ±‚ï¼Œä¾‹å¦‚å»ºè®® p ä¸º 512 ä½çš„å¤§ç´ æ•°ï¼Œå…·ä½“ç»†èŠ‚è¿™é‡Œæš‚æ—¶å¿½ç•¥ã€‚

\\[ y \equiv g^{x} \  (\textrm{mod} \  p) \\]

ä»¥ Alice å’Œ Bob ä¸ºä¾‹ï¼Œä»–ä»¬å„è‡ªç”Ÿæˆä¸€ä¸ªéšæœºæ•° aï¼Œbï¼Œåˆ†åˆ«è®¡ç®—å¾—åˆ° Aï¼ŒBï¼Œå¹¶å°†è®¡ç®—çš„ç»“æžœå‘é€ç»™å¯¹æ–¹ï¼Œå¯¹æ–¹åœ¨æŽ¥æ”¶åˆ°åŽè¿›è¡ŒäºŒæ¬¡è®¡ç®—å¾—åˆ°æœ€ç»ˆçš„å…±äº«å¯†é’¥ï¼Œè®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š

\\[ A \equiv g^{a} \  (\textrm{mod} \  p) \\]
\\[ B \equiv g^{b} \  (\textrm{mod} \  p) \\]
\\[ K \equiv B^{a} \  (\textrm{mod} \  p) = (g^{b})^{a} \ (\textrm{mod} \  p) \\]
\\[ K \equiv A^{b} \  (\textrm{mod} \  p) = (g^{a})^{b} \ (\textrm{mod} \  p)\\]

ç”±æ­¤ Alice å’Œ Bob å¾—åˆ°äº†åªæœ‰ä»–ä»¬ä¸¤ä¸ªäººçŸ¥é“çš„å…±äº«å¯†é’¥ï¼Œå…¶ä¸­ gã€p ä¸¤ä¸ªç´ æ•°å…¬å¼€ï¼ŒA å’Œ B ä¹Ÿå…¬å¼€ï¼Œåªæœ‰ä¸¤ä¸ªéšæœºæ•° a å’Œ b éœ€è¦ä¿å¯†ã€‚ä¸ºäº†æ›´å½¢è±¡åœ°ç†è§£ï¼Œå¯ä»¥å‚è€ƒä¸‹é¢çš„ [ç¤ºä¾‹](https://l2x.gitbooks.io/understanding-cryptography/docs/chapter-3/diffie-hellman%E5%AF%86%E9%92%A5%E4%BA%A4%E6%8D%A2.html)ï¼š

![](https://l2x.gitbooks.io/understanding-cryptography/assets/dh.png)

> [Diffie-Hellman Protocol](http://mathworld.wolfram.com/Diffie-HellmanProtocol.html)

#### ECDH

ECDH å¯†é’¥äº¤æ¢ç®—æ³•æ˜¯ ECC å’Œ Diffie-Hellman çš„ç»“åˆï¼Œå…·ä½“è¿‡ç¨‹ç±»ä¼¼ï¼Œåªä¸è¿‡ ECDH çš„å®‰å…¨æ€§ä¾èµ–äºŽæ¤­åœ†æ›²çº¿ä¸Šç‚¹æž„æˆçš„ç¾¤æ‰€å¯¹åº”ç¦»æ•£å¯¹æ•°é—®é¢˜çš„å¤æ‚æ€§ã€‚æ¤­åœ†æ›²çº¿å¯†ç å­¦ï¼ˆECCï¼‰å…·æœ‰é«˜å¼ºåº¦çš„å®‰å…¨æ€§ï¼Œå¯ä»¥åœ¨æ›´çŸ­å¯†é’¥çš„æƒ…å†µä¸‹è¾¾åˆ°ç›¸åŒçš„å®‰å…¨æ€§ã€‚å…·ä½“çš„ä¼šåœ¨ä¸‹æ–‡å•ç‹¬ä»‹ç»ã€‚ä¸‹é¢é€šè¿‡ OpenSSL å¯†ç åº“ä¸¾ä¸ªä¾‹å­ï¼š

{% highlight bash %}
# åŒæ–¹å„è‡ªç”Ÿæˆå¯†ç å¯¹
openssl ecparam -name secp256k1 -genkey -noout -out alice_priv_key.pem
openssl ec -in alice_priv_key.pem -pubout -out alice_pub_key.pem

openssl ecparam -name secp256k1 -genkey -noout -out bob_priv_key.pem
openssl ec -in bob_priv_key.pem -pubout -out bob_pub_key.pem

# åŒæ–¹æ ¹æ®è‡ªèº«ç§é’¥å’Œå¯¹æ–¹å…¬é’¥ç”Ÿæˆ å…±äº«å¯†é’¥
openssl pkeyutl -derive -inkey alice_priv_key.pem -peerkey bob_pub_key.pem -out alice_shared_secret.bin
openssl pkeyutl -derive -inkey bob_priv_key.pem -peerkey alice_pub_key.pem -out bob_shared_secret.bin

# å¯¹æ¯”æŸ¥çœ‹å¯†é’¥æ˜¯å¦ä¸€è‡´
base64 alice_shared_secret.bin
base64 bob_shared_secret.bin

# è‡ªå®šä¹‰ä¼ è¾“å†…å®¹
echo "Hi, Bob, this is secret message from Alice" > plain.txt

# ä¼ é€æ–¹åŠ å¯†ä¼ è¾“å†…å®¹
openssl enc -aes256 -base64 -k $(base64 alice_shared_secret.bin) -e -in plain.txt -out cipher.txt

# æŽ¥æ”¶æ–¹è§£å¯†
openssl enc -aes256 -base64 -k $(base64 bob_shared_secret.bin) -d -in cipher.txt -out plain_again.txt

# è¯»å–éªŒè¯ä¼ è¾“å†…å®¹
cat plain_again.txt
{% endhighlight %}

è™½ç„¶ä¸Šè¿°ç®—æ³•å¯ä»¥è§£å†³ä¿å¯†æ€§é—®é¢˜ï¼Œä½†ç”±äºŽ ECDH å¯†é’¥äº¤æ¢åè®®ä¸éªŒè¯å…¬é’¥å‘é€è€…çš„èº«ä»½ï¼Œå› æ­¤æ— æ³•é˜»æ­¢ä¸­é—´äººæ”»å‡»ã€‚å¦‚æžœç›‘å¬è€… Mallory æˆªèŽ·äº† Alice çš„å…¬é’¥ï¼Œå°±å¯ä»¥æ›¿æ¢ä¸ºä»–è‡ªå·±çš„å…¬é’¥ï¼Œå¹¶å°†å…¶å‘é€ç»™ Bobã€‚Mallory è¿˜å¯ä»¥æˆªèŽ· Bob çš„å…¬é’¥ï¼Œæ›¿æ¢ä¸ºä»–è‡ªå·±çš„å…¬é’¥ï¼Œå¹¶å°†å…¶å‘é€ç»™ Aliceã€‚è¿™æ ·ï¼ŒMallory å°±å¯ä»¥è½»æ¾åœ°å¯¹ Alice ä¸Ž Bob ä¹‹é—´å‘é€çš„ä»»ä½•æ¶ˆæ¯è¿›è¡Œè§£å¯†ã€‚ä»–å¯ä»¥æ›´æ”¹æ¶ˆæ¯ï¼Œç”¨ä»–è‡ªå·±çš„å¯†é’¥å¯¹æ¶ˆæ¯é‡æ–°åŠ å¯†ï¼Œç„¶åŽå°†æ¶ˆæ¯å‘é€ç»™æŽ¥æ”¶è€…ã€‚ä¸ºäº†è§£å†³æ­¤é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨å…¬å…±è¯ä¹¦é¢å‘æœºæž„ (CA) å‘åŒæ–¹æä¾›å¯ä¿¡æ•°å­—ç­¾åå¯†é’¥ã€‚

> [ECDH ç®—æ³•æ¦‚è¿°](https://docs.microsoft.com/zh-cn/previous-versions/visualstudio/visual-studio-2008/cc488016(v=vs.90))

## éžå¯¹ç§°å¯†ç 

å…¬é’¥å¯†ç ï¼ˆPublic-key cryptographyï¼‰ï¼Œä¹Ÿç§°éžå¯¹ç§°å¯†ç å­¦ï¼ˆasymmetric cryptographyï¼‰ä¸­ï¼Œå¯†é’¥åˆ†ä¸ºå…¬é’¥ï¼ˆpublic keyï¼‰å’Œç§é’¥ï¼ˆprivate keyï¼‰ï¼Œå‰è€…ç”¨äºŽåŠ å¯†ï¼ŒåŽè€…ç”¨äºŽè§£å¯†ï¼Œä¸¤è€…ä¸€ä¸€å¯¹åº”ï¼Œç»Ÿç§°å¯†é’¥å¯¹ï¼ˆkey pairï¼‰ã€‚ä¸¾ä¸ªä¾‹å­ï¼ŒåŒæ–¹é€šä¿¡æ—¶ï¼Œå…¶ä¸­ä¸€æ–¹å°†è‡ªå·±çš„å…¬é’¥ç»™å¯¹æ–¹ï¼Œè¦æ±‚å¯¹æ–¹ç”¨è¿™ä¸ªå…¬é’¥åŠ å¯†åŽå‘æ¶ˆæ¯ç»™è‡ªå·±ï¼Œè¿™æ ·ä¸€æ¥ï¼Œåªæœ‰æ‹¥æœ‰çš„ç§é’¥çš„è‡ªå·±æ‰èƒ½å®Œæˆæ¶ˆæ¯çš„è§£å¯†ï¼Œå®žçŽ°äº†æ¶ˆæ¯çš„å®‰å…¨ä¼ è¾“ã€‚å¯¹æ¯”å¯çŸ¥ï¼Œç›¸æ¯”å¯¹ç§°åŠ å¯†ï¼Œéžå¯¹ç§°åŠ å¯†ä¸å­˜åœ¨å¯†é’¥é…é€é—®é¢˜ã€‚

### RSA

RSA ç®—æ˜¯æœ€ä¸ºæ™®åŠçš„ä¸€ç§å…¬é’¥å¯†ç ç®—æ³•ï¼Œå…¶å¯é æ€§ç”±è´¨å› æ•°åˆ†è§£çš„å¤æ‚åº¦ä¿è¯ï¼Œå³å¯¹ä¸¤ä¸ªè´¨æ•°ç›¸ä¹˜å®¹æ˜“ï¼Œè€Œå°†å…¶åˆæ•°åˆ†è§£å¾ˆéš¾ã€‚ä¸€æ—¦å‘çŽ°äº†å¯¹å¤§æ•´æ•°è¿›è¡Œè´¨å› åˆ†è§£çš„é«˜æ•ˆç®—æ³•ï¼Œå°±å¯ä»¥å¯¹ RSA è¿›è¡Œç ´è§£ã€‚ä¸ºäº†å®‰å…¨èµ·è§ï¼Œå®žé™…åº”ç”¨ä¸­ RSA å¯†é’¥é•¿åº¦å¯é€‰æ‹©ä¸º 2048ä½ï¼Œå®‰å…¨æ€§è¦æ±‚æ›´é«˜ä¹Ÿå¯ä»¥é€‰æ‹© 4096ä½ã€‚RSA ç”Ÿæˆå¯†é’¥å¯¹çš„æ­¥éª¤å¦‚ä¸‹ï¼š

1. ç¡®å®š Nï¼Œé¦–å…ˆç”¨ä¼ªéšæœºç”Ÿæˆå™¨ç”Ÿæˆä¸¤ä¸ªå¤§è´¨æ•°ï¼Œè®°ä¸º pï¼Œqï¼Œè®¡ç®— N = *p* * *q*
2. ç¡®å®š Lï¼ŒL = *Ï†* (N) = *Ï†* (*p* ) * *Ï†* (*q*) = (*p* -1) * (*q*-1)
3. ç¡®å®š Eï¼Œé€‰æ‹©ä¸€ä¸ªå°äºŽ L çš„æ•´æ•° Eï¼Œå¹¶æ»¡è¶³ E å’Œ L äº’è´¨
4. ç¡®å®š Dï¼Œåœ¨æ±‚å¾— E çš„åŸºç¡€ä¹‹ä¸Šï¼Œé€‰æ‹©ä¸€ä¸ªå°äºŽ L å¤§äºŽ 1 çš„æ•´æ•° Dï¼Œå¹¶æ»¡è¶³ $$  E* D  \equiv 1 \  (\textrm{mod} \  L) $$

ç”±ä¸Šæ­¥éª¤è®¡ç®—å¾—åˆ° RSA ç§é’¥å¯¹ä¸º(Dï¼ŒN)ï¼Œå…¬é’¥å¯¹(Eï¼ŒN)ï¼Œè¿›ä¸€æ­¥åŠ è§£å¯†è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š

\\[ \textrm{åŠ å¯†è¿‡ç¨‹ï¼š} \ \textrm{Decrypted}= \textrm{Plain}^{E} \ mod \ N \\]
\\[ \textrm{è§£å¯†è¿‡ç¨‹ï¼š} \ \textrm{Plain}= \textrm{Decrypted}^{D} \ mod \ N \\]

ä¸Šé¢åªæ˜¯å¯¹ RSA åšä¸€ä¸ªæœ€åŸºæœ¬çš„ä»‹ç»ï¼Œå¯¹æ•°å­¦åŸºç¡€å’ŒæŽ¨å¯¼æš‚æ—¶ä¸è¿›è¡Œå±•å¼€ã€‚å¦‚æžœæƒ³è¦æ·±å…¥äº†è§£å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« ï¼š[Prime Number Hide-and-Seek: How the RSA Cipher Works](http://www.muppetlabs.com/~breadbox/txt/rsa.html)

### ECC

æ¤­åœ†æ›²çº¿å¯†ç å­¦ï¼ˆECC) æ˜¯ä¸€ç§é«˜æ•ˆçš„éžå¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œå…¶ä¸­æ¤­åœ†å¯†ç æ›²çº¿ï¼ˆElliptic Curveï¼‰å®Œæ•´çš„å®šä¹‰å¯å‚è€ƒ [Wolfram MathWorld](http://mathworld.wolfram.com/EllipticCurve.html)ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¯ä»¥ç”¨ä»¥ä¸‹æ–¹ç¨‹å¼è¡¨ç¤ºï¼š

![](/img/in-post/ECC/ECC-08.gif)

å›¾ç¤ºå¦‚ä¸‹ï¼š

![](https://kangfeihk.com/img/in-post/ECC/ECC-01.png)

æˆ‘ä»¬çŸ¥é“ RSA æ­£æ˜¯åˆ©ç”¨äº†â€œ**å¤§æ•°è´¨å› æ•°åˆ†è§£**â€çš„éš¾åº¦ï¼Œä»Žè€Œä¿è¯äº†å…¶å®‰å…¨æ€§ã€‚åŒæ ·åœ°ï¼ŒDiffie-Hellman å¯†é’¥äº¤æ¢åˆ™æ˜¯åˆ©ç”¨äº†â€œ**æœ‰é™åŸŸä¸Šçš„ç¦»æ•£å¯¹æ•°é—®é¢˜**â€çš„å¤æ‚åº¦ã€‚åœ¨ ECC ä¸­ï¼Œåˆ™æ˜¯ç”±â€œ**æ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°é—®é¢˜**â€æ¥ä¿è¯å…¶å®‰å…¨æ€§ã€‚åœ¨ä»‹ç»é—®é¢˜ä¹‹å‰ï¼Œå…ˆçœ‹ä¸€ä¸‹ç›¸å…³é¢„å¤‡çŸ¥è¯†ï¼š

#### ç¾¤

ç¾¤æ˜¯ä¸€ä¸ªé›†åˆGï¼Œè¿žåŒä¸€ä¸ªè¿ç®— "Â·"ï¼Œå®ƒç»“åˆä»»ä½•ä¸¤ä¸ªå…ƒç´  a å’Œ b è€Œå½¢æˆå¦ä¸€ä¸ªå…ƒç´ ï¼Œè®°ä¸º aÂ·bã€‚ç¬¦å·"Â·"æ˜¯å…·ä½“çš„è¿ç®—ï¼Œä¾‹å¦‚åŠ æ³•ã€‚è¦å…·å¤‡æˆä¸ºç¾¤çš„èµ„æ ¼ï¼Œè¿™ä¸ªé›†åˆå’Œè¿ç®— (G,Â·) å¿…é¡»æ»¡è¶³å«åšç¾¤å…¬ç†çš„å››ä¸ªè¦æ±‚ï¼š
1. å°é—­æ€§ï¼šå¯¹äºŽæ‰€æœ‰ G ä¸­ a, bï¼Œè¿ç®— aÂ·b çš„ç»“æžœä¹Ÿåœ¨ G ä¸­ã€‚
2. ç»“åˆæ€§ï¼šå¯¹äºŽæ‰€æœ‰ G ä¸­çš„ a, b å’Œ cï¼Œç­‰å¼ (aÂ·b)Â·c = aÂ· (bÂ·c)æˆç«‹ã€‚
3. å•ä½å…ƒï¼šå­˜åœ¨ G ä¸­çš„ä¸€ä¸ªå•ä½å…ƒ 0ï¼Œä½¿å¾—å¯¹äºŽæ‰€æœ‰ G ä¸­çš„å…ƒç´  aï¼Œç­‰å¼ 0Â·a = aÂ·0 = 0 æˆç«‹ã€‚
4. é€†å…ƒï¼šå¯¹äºŽæ¯ä¸ª G ä¸­çš„ aï¼Œå­˜åœ¨ G ä¸­çš„ä¸€ä¸ªå…ƒç´  b ä½¿å¾— aÂ·b = bÂ·a = 0ï¼Œè¿™é‡Œçš„ 0 æ˜¯å•ä½å…ƒã€‚
å¦‚æžœåŠ ä¸Šç¬¬äº”æ¡è¦æ±‚ï¼Œ
5. è¦æ±‚ç¬¦åˆäº¤æ¢å¾‹ aÂ·b = bÂ·a

è¿™æ ·çš„ç¾¤æˆ‘ä»¬ç§°ä¹‹ä¸º **é˜¿è´å°”ç¾¤ï¼ˆAbelian groupï¼‰** ä¹Ÿå« **äº¤æ¢ç¾¤ï¼ˆcommutative groupï¼‰**ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæ•´æ•°é›†åˆ Z ä¸ä½†æ»¡è¶³ç¾¤çš„å®šä¹‰ï¼Œè¿˜ç¬¦åˆé˜¿è´å°”ç¾¤çš„è¦æ±‚ã€‚è€Œè‡ªç„¶æ•°é›†åˆ N ç”±äºŽç¬¬ 4 æ¡çš„é™åˆ¶ï¼Œå°±ä¸æ»¡è¶³ç¾¤çš„å®šä¹‰ã€‚

#### æ¤­åœ†æ›²çº¿ä¸Šçš„ç¾¤å…¬ç†

æˆ‘ä»¬åœ¨æ¤­åœ†æ›²çº¿ä¸Šå®šä¹‰ç¾¤å…¬ç†çš„å‡ ä¸ªè¦æ±‚ï¼š
1. ç¾¤ä¸­çš„å…ƒç´ éƒ½åœ¨æ¤­åœ†æ›²çº¿ä¸Š
2. å•ä½å…ƒæŒ‡å‘æ— ç©·è¿œå¤„ 0
3. æ›²çº¿ä¸Šä»»æ„ä¸€ç‚¹ P çš„é€†å…ƒå…³äºŽ x è½´å¯¹ç§°
4. åŠ æ³•å®šä¹‰å¦‚ä¸‹ï¼šä¸€æ¡ç›´çº¿ä¸Šä¸Žæ›²çº¿ç›¸äº¤åœ°ä¸‰ä¸ªéžé›¶ç‚¹ Pï¼ŒQï¼ŒRï¼Œæ»¡è¶³åŠ æ³•è¿ç®—è§„åˆ™ï¼ŒP + Q + R = 0.ï¼ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œé‡è¦ï¼‰

![](/img/in-post/ECC/three-aligned-points.png)

è¿™é‡Œçš„åŠ æ³•ï¼Œæˆ‘ä»¬ä¸è¦æ±‚è¿ç®—çš„é¡ºåºï¼ŒP + (Q + R) = Q + (P + R) = 0ï¼Œå› æ­¤ä¹Ÿæ»¡è¶³é˜¿è´å°”ç¾¤çš„å®šä¹‰ã€‚ä¸‹é¢æˆ‘ä»¬å¯ä»¥é€æ¸äº†è§£åˆ° **ECC çš„æ•°å­¦åŸºç¡€**æ­£æ˜¯ç”±æ¤­åœ†æ›²çº¿ä¸Šçš„ç‚¹æž„æˆçš„é˜¿è´å°”åŠ æ³•ç¾¤ä¸­ ECDLP é—®é¢˜çš„å¤æ‚åº¦ã€‚

ä¸‹é¢æˆ‘ä»¬çœ‹ä¸€ä¸‹ä»»æ„ä¸¤ä¸ªæ•°çš„åŠ æ³•è¿ç®—ï¼Œä»¥ P + Q ä¸ºä¾‹ï¼Œæˆ‘ä»¬çŸ¥é“ P + Q + R = 0ï¼Œåˆå› ä¸ºé˜¿è´å°”ç¾¤çš„å®šä¹‰ï¼Œå¼å­å¯ä»¥è½¬æ¢ä¸º P + Q = - R, - R å’Œ R å…³äºŽ x è½´å¯¹ç§°ï¼Œç›´è§‚çš„ç»“æžœå¦‚ä¸‹å›¾æ‰€ç¤º

![](/img/in-post/ECC/point-addition.png)

ä¸‹é¢çœ‹ä¸€ä¸‹ç‰¹æ®Šæƒ…å†µçš„è¿ç®—ï¼š
- å¦‚æžœ P = 0 æˆ–è€… Q = 0ï¼Œç”±äºŽå®šä¹‰äº†æ— ç©·è¿œå¤„ 0 ä¸ºå•ä½å…ƒï¼Œå› æ­¤å¯ä»¥å¾—çŸ¥ï¼Œå¯¹äºŽæ›²çº¿ä¸Šä»»æ„çš„ç‚¹ P æˆ–è€…ç‚¹ Qï¼ŒP + 0 = P æˆ–è€… Q + 0 = Q éƒ½æ˜¯æˆç«‹çš„
- å¦‚æžœ P = - Qï¼Œåˆ™æ ¹æ®é€†å…ƒçš„å®šä¹‰å¯çŸ¥ï¼ŒP å’Œ Q å…³äºŽ x è½´å¯¹ç§°ï¼ŒP + Q = P +ï¼ˆ- Pï¼‰ = 0
- å¦‚æžœ P = Qï¼Œé‚£ä¹ˆè¿‡ P ç‚¹çš„åˆ‡çº¿ä¸Žæ¤­åœ†æ›²çº¿ç›¸äº¤äºŽå¦ä¸€ç‚¹ Rï¼Œå¾— P + P = - R

ä½œè€…æä¾›äº†[å¯è§†åŒ–è®¡ç®—åŠ æ³•](https://cdn.rawgit.com/andreacorbellini/ecc/920b29a/interactive/reals-add.html?px=-1&py=4&qx=1&qy=2)çš„åœ¨çº¿å·¥å…·ï¼Œæœ‰å…´è¶£å¯ä»¥æ‰‹åŠ¨å°è¯•ã€‚

é™¤äº†åŠ æ³•ï¼Œæˆ‘ä»¬å®šä¹‰ä¹˜æ³•å¦‚ä¸‹ï¼š*n*P å³ *n* ä¸ª P ç›¸åŠ çš„å’Œï¼Œå¯åœ¨[è¿™é‡Œ](https://cdn.rawgit.com/andreacorbellini/ecc/920b29a/interactive/reals-mul.html)è¿›è¡Œæ‰‹åŠ¨æŸ¥çœ‹è®¡ç®—è¿‡ç¨‹ã€‚ä»¥ *n* = 151 ä¸ºä¾‹ï¼Œå¦‚æžœæŒ‰ç…§æ­£å¸¸è¿ç®—ï¼Œå¯¹äºŽ *k* ä½çš„äºŒè¿›åˆ¶æ•°å­—ï¼Œè®¡ç®—æ—¶é—´å¤æ‚åº¦ä½ $$ O(2^{k}) $$ï¼Œæ•ˆçŽ‡å¤ªä½Žã€‚ç»“åˆä¸Šé¢ä»‹ç»è¿‡çš„è¿ç®—è§„åˆ™ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ 151 è½¬æ¢æˆäºŒè¿›åˆ¶ 10010111ï¼Œ

\\[ 151P = 2^{7} P + 2^{4} P + 2^{2} P + 2^{1} P + 2^{0} \\]

å¯ä»¥å¤§å¤§æé«˜è¿ç®—æ¬¡æ•°ï¼Œæ—¶é—´å¤æ‚åº¦ä¸‹é™è‡³ $$ O(\mathrm{log}n) $$ æˆ–è€… $$ O(k) $$

æ¤­åœ†æ›²çº¿ä¸Šçš„äºŒå€è¿ç®—è¿‡ç¨‹å¯ä»¥å‚è§ä¸‹å›¾ï¼š

![](/img/in-post/ECC/ECC-03.png)

æˆ‘ä»¬å®šä¹‰ä¸Šè¿°è¿ç®—çš„é€†è¿ç®—ä¸ºå¯¹æ•°è¿ç®—ï¼Œå³å·²çŸ¥ P å’Œ Qï¼Œæ±‚å‡º n çš„å€¼ã€‚

#### æœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿

å‰é¢çš„æè¿°ä»¥åŠè®¡ç®—éƒ½æ˜¯åœ¨å®žæ•°åŸŸèŒƒå›´å†…è¿›è¡Œçš„ï¼Œåœ¨ ECC ä¸­ï¼Œå°†æ¤­åœ†æ›²çº¿ä¸¥æ ¼é™åˆ¶åˆ°æœ‰é™åŸŸï¼ˆfiniite fieldsï¼‰ä¸­æ¥æå‡éš¾åº¦ã€‚

æœ‰é™åŸŸï¼Œæ˜¯ä¸€ä¸ªæœ‰é™æ•°å­—å…ƒç´ çš„é›†åˆï¼Œä¸‹é¢ç»Ÿä¸€è®°ä¸º Fð‘ ï¼ŒåŒ…æ‹¬äº†æ‰€æœ‰ 0 åˆ° p-1 çš„æ•´æ•°ã€‚æœ‰é™åŸŸæœ€å¸¸è§çš„ä¾‹å­æ˜¯å½“ *p* ä¸ºç´ æ•°æ—¶ï¼Œæ•´æ•°å¯¹ *p* å–æ¨¡ã€‚å…¶ä¸­æœ‰é™åŸŸçš„é˜¶ï¼ˆæœ‰é™åŸŸä¸­å…ƒç´ çš„ä¸ªæ•°ï¼‰æ˜¯ä¸€ä¸ªç´ æ•°çš„å¹‚ã€‚æœ‰é™åŸŸä¸Šçš„åŠ å‡ä¹˜é™¤ç›¸å¯¹æ¯”è¾ƒç®€å•ï¼Œå¤šä¸€æ­¥æ¨¡æ“ä½œï¼Œè¿™é‡Œä¸å±•å¼€ï¼Œç®€å•æä¸€ä¸‹ï¼Œé™¤æ³•è¿ç®—éœ€è¦å…ˆæ‰¾åˆ°ä¸€ä¸ªå€’æ•°å†è¿›è¡Œä¹˜æ³•è¿ç®—ã€‚

å‰é¢æˆ‘ä»¬å®šä¹‰æ›²çº¿çš„ç‚¹é›†ä¸ºï¼š

![](/img/in-post/ECC/ECC-08.gif)

ä¸‹é¢åˆ‡æ¢åˆ°æœ‰é™åŸŸ Fp ä¸Šï¼Œ

![](/img/in-post/ECC/ECC-09.gif)

å…¶ä¸­ 0 ä¾æ—§è®¤ä¸ºæ˜¯æ— é™è¿œçš„ç‚¹ï¼Œä»¥åŠ a å’Œ b æ˜¯åœ¨ Fp ä¸Šçš„ä¸¤ä¸ªæ•´æ•°ã€‚å¯ä»¥è¯æ˜Žæ¤­åœ†æ›²çº¿åœ¨æœ‰é™åŸŸ Fp ä¸Šè¿˜æ˜¯ä¸€ä¸ªé˜¿è´å°”ç¾¤ã€‚

åœ¨æœ‰é™åŸŸä¸Šé¢çš„æ¤­åœ†æ›²çº¿å¹¶ä¸æ˜¯ä¸€æ¡æ›²çº¿ï¼Œè€Œæ˜¯ä¸€äº›ä¸è¿žç»­çš„ç‚¹é›†ã€‚

![](/img/in-post/ECC/ECC-02.png)

ä¸Šå›¾è¡¨ç¤ºæ›²çº¿æ˜¯åœ¨ç´ æ•°é˜¶pçš„æœ‰é™åŸŸå†…ï¼Œä¸” *p* å–è¾ƒå°å€¼17ï¼Œéšç€ *p* å€¼çš„å¢žå¤§ï¼Œå›¾å½¢çš„å¤æ‚åº¦è¿…é€Ÿå¢žå¤§ã€‚

åœ¨åŒä¸€æ¡ç›´çº¿çš„ä¸‰ä¸ªç‚¹ Pï¼ŒQï¼ŒRï¼ŒåŒæ ·æ»¡è¶³ P + Q + R = 0ï¼Œåªä¸è¿‡ç›´çº¿çš„å®šä¹‰éœ€è¦æ›´æ”¹ä¸ºç‚¹é›†ï¼š$$ ax + by + c = 0 \ (\mathrm {mod} \; p) $$

ç»™å®šä¸€ä¸ªéžé›¶ç‚¹ Qï¼Œå…¶ç›¸åæ•°å¯ä»¥è¡¨ç¤ºä¸ºï¼š$$\left ( x_{Q},-y_{Q}\; \mathrm {mod} \; P \right )$$ï¼Œä¾‹å¦‚åœ¨ $$\mathrm{F}_{29}$$ ä¸Šï¼Œè®° Q ä¸º (2ï¼Œ5)ï¼Œé‚£ä¹ˆ - Q = (2ï¼Œ- 5 mod 29) = (2,24)

åœ¨å®žæ•°åŸŸä¸Šï¼Œ2P çš„è®¡ç®—éœ€è¦å¾—åˆ°æ›²çº¿åœ¨ç‚¹ P çš„åˆ‡çº¿ï¼Œä½†åœ¨ä¸è¿žç»­çš„åŸŸä¸Šï¼Œä¸å†é€‚ç”¨è¿™ç§æ–¹å¼ã€‚

å¥½äº†ï¼Œåœ¨äº†è§£äº†ä»¥ä¸ŠåŸºç¡€çŸ¥è¯†ä¹‹åŽï¼Œå›žåˆ°æ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°é—®é¢˜ï¼Œæœ¬è´¨å³æ˜¯

- å·²çŸ¥
    - æ¤­åœ†æ›²çº¿ E
    - æ¤­åœ†æ›²çº¿ E ä¸Šä¸€ç‚¹ Gï¼ˆåŸºç‚¹ï¼‰
    - æ¤­åœ†æ›²çº¿ E ä¸Šçš„ä¸€ç‚¹ xGï¼ˆx å€çš„ Gï¼‰
- æ±‚è§£
    - x

è¿™ä¸ªé—®é¢˜çš„éš¾åº¦ä¿è¯äº†æ¤­åœ†æ›²çº¿å¯†ç çš„å®‰å…¨æ€§ã€‚

> [A (relatively easy to understand) primer on elliptic curve cryptography](https://arstechnica.com/information-technology/2013/10/a-relatively-easy-to-understand-primer-on-elliptic-curve-cryptography/)
